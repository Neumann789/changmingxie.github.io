{
  "filename": "embedded-sample.md",
  "__html": "<h1 id=\"embedded%E6%A8%A1%E5%BC%8F%E7%A4%BA%E4%BE%8B\">embedded模式示例 <a class=\"header-anchor\" href=\"#embedded%E6%A8%A1%E5%BC%8F%E7%A4%BA%E4%BE%8B\">#</a></h1>\n<p><strong>注意</strong>：tcc-transaction-1.x版本均为embedded模式，其使用方式<a href=\"https://github.com/changmingxie/tcc-transaction/wiki/2-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B\">详见</a></p>\n<p>这里用dubbo-sample来介绍如何使用tcc-transaction的<a href=\"/zh-cn/docs/tutorial/connectionmode/embedded.html\"><strong>embedded模式</strong></a></p>\n<p><strong>示例工程:</strong><a href=\"https://github.com/changmingxie/tcc-transaction/tree/master-2.x/tcc-transaction-tutorial-sample/tcc-transaction-dubbo-sample\">tcc-transaction-dubbo-sample</a></p>\n<blockquote>\n<p>tcc-transaction-dubbo-capital(资金服务)<br>\ntcc-transaction-dubbo-redpacket(红包服务)<br>\ntcc-transaction-dubbo-order(订单服务)</p>\n</blockquote>\n<p><strong>sample特征</strong>：</p>\n<ul>\n<li>采用dubbo的远程调用方式</li>\n<li>springboot启动，springxml配置tcc</li>\n<li>采用tcc-transaction的embedded模式+存储类型(memory/redis)</li>\n</ul>\n<p><strong>示例图</strong><br>\n<img src=\"../../img/sample_tcc_embedded.jpg\" alt=\"embedded模式示例\"></p>\n<p>以下将一步一步教大家如何使用tcc-transaction的embedded模式<br>\n<strong>步骤如下</strong></p>\n<ul>\n<li>dashboard部署</li>\n<li>资金服务开发</li>\n<li>红包服务开发</li>\n<li>订单服务开发</li>\n<li>功能演示</li>\n</ul>\n<h2 id=\"dashboard%E9%83%A8%E7%BD%B2\">dashboard部署 <a class=\"header-anchor\" href=\"#dashboard%E9%83%A8%E7%BD%B2\">#</a></h2>\n<p>如资金服务、红包服务、订单服务采用的embedded存储类型为redis，可以结合dashboard演示。\n<a href=\"/zh-cn/docs/ops/dashboard/deploy-embedded.html\">dashboard embedded模式部署</a><br>\n对应application.yaml可如下配置(embedded模式redis)</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">server:</span>\n  <span class=\"hljs-attr\">servlet:</span>\n    <span class=\"hljs-attr\">context-path:</span> <span class=\"hljs-string\">/tcc-transaction-dashboard</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">22332</span>\n<span class=\"hljs-attr\">logging:</span>\n  <span class=\"hljs-attr\">level:</span>\n    <span class=\"hljs-attr\">root:</span> <span class=\"hljs-string\">info</span>\n<span class=\"hljs-attr\">spring:</span>\n  <span class=\"hljs-attr\">application:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">tcc-transaction-dashboard</span>\n  <span class=\"hljs-attr\">tcc:</span>\n    <span class=\"hljs-attr\">dashboard:</span>\n      <span class=\"hljs-attr\">data-fetch-type:</span> <span class=\"hljs-string\">local</span>\n    <span class=\"hljs-attr\">storage:</span>\n      <span class=\"hljs-attr\">storage-type:</span> <span class=\"hljs-string\">redis</span>\n      <span class=\"hljs-attr\">redis:</span>\n        <span class=\"hljs-attr\">host:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>\n        <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">6379</span>\n        <span class=\"hljs-attr\">database:</span> <span class=\"hljs-number\">0</span>\n        <span class=\"hljs-attr\">pool-config:</span>\n          <span class=\"hljs-attr\">max-total:</span> <span class=\"hljs-number\">100</span>\n          <span class=\"hljs-attr\">max-idle:</span> <span class=\"hljs-number\">100</span>\n          <span class=\"hljs-attr\">min-idle:</span> <span class=\"hljs-number\">10</span>\n          <span class=\"hljs-attr\">max-wait-millis:</span> <span class=\"hljs-number\">300</span>\n</code></pre>\n<h2 id=\"%E8%B5%84%E9%87%91%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">资金服务开发 <a class=\"header-anchor\" href=\"#%E8%B5%84%E9%87%91%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">#</a></h2>\n<p>涉及两个模块的开发：</p>\n<ul>\n<li>tcc-transaction-dubbo-capital-api，方便调用方使用接口定义</li>\n<li>tcc-transaction-dubbo-capital，提供资金相关操作实现、服务暴露等功能</li>\n</ul>\n<h3 id=\"tcc-transaction-dubbo-capital-api%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-capital-api开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-capital-api%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>方便调用方使用资金服务的接口定义</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-api<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h4 id=\"%E5%A3%B0%E6%98%8Etcc%E6%8E%A5%E5%8F%A3\">声明tcc接口 <a class=\"header-anchor\" href=\"#%E5%A3%B0%E6%98%8Etcc%E6%8E%A5%E5%8F%A3\">#</a></h4>\n<p>使用<a href=\"/zh-cn/docs/tutorial/api.html#%40enabletcc\">@EnableTcc</a>传递上下文</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">CapitalTradeOrderService</span> </span>{\n    <span class=\"hljs-meta\">@EnableTcc</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">record</span><span class=\"hljs-params\">(CapitalTradeOrderDto tradeOrderDto)</span></span>;\n}\n</code></pre>\n<h3 id=\"tcc-transaction-dubbo-capital%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-capital开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-capital%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>提供资金相关操作实现、服务暴露等功能</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-1\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-1\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-dubbo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-spring<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h4 id=\"spring-xml%E9%85%8D%E7%BD%AE\">spring xml配置 <a class=\"header-anchor\" href=\"#spring-xml%E9%85%8D%E7%BD%AE\">#</a></h4>\n<p>appcontext-service-tcc.xml开发，这里提供了embedded模式的两种配置，您可以选择一种配置：</p>\n<ul>\n<li>embedded存储模式之MEMORY</li>\n<li>embedded存储模式之REDIS(如需演示dashboard，可选择此中存储类型)</li>\n</ul>\n<h5 id=\"embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory\">embedded存储模式之MEMORY <a class=\"header-anchor\" href=\"#embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:CAPITAL\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--embedded存储模式(MEMORY)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"MEMORY\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h5 id=\"embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis\">embedded存储模式之REDIS <a class=\"header-anchor\" href=\"#embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:CAPITAL\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--embedded存储模式(REDIS)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"REDIS\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"redis\"</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.RedisStoreProperties\"</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"host\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"127.0.0.1\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"port\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"6379\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"database\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"0\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"poolConfig\"</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"redis.clients.jedis.JedisPoolConfig\"</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxTotal\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxWaitMillis\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"300\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"minIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"10\"</span>/&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h4 id=\"tcc%E5%AE%9E%E7%8E%B0\">tcc实现 <a class=\"header-anchor\" href=\"#tcc%E5%AE%9E%E7%8E%B0\">#</a></h4>\n<p>在tcc实现上方法上添加<a href=\"/zh-cn/docs/tutorial/api.html#%40compensable\">@Compensable</a>注解，设置confirmMethod和cancelMethod方法，分别为tcc的confirm和cancel方法。<br>\n<strong>特别注意</strong>：confirm和cancel方法参数要与try保持一致。</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CapitalTradeOrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">CapitalTradeOrderService</span> </span>{\n    <span class=\"hljs-meta\">@Compensable</span>(confirmMethod = <span class=\"hljs-string\">\"confirmRecord\"</span>, cancelMethod = <span class=\"hljs-string\">\"cancelRecord\"</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">record</span><span class=\"hljs-params\">(CapitalTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do someting ...</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"success\"</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">confirmRecord</span><span class=\"hljs-params\">(CapitalTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">cancelRecord</span><span class=\"hljs-params\">(CapitalTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n}\n\n</code></pre>\n<h2 id=\"%E7%BA%A2%E5%8C%85%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">红包服务开发 <a class=\"header-anchor\" href=\"#%E7%BA%A2%E5%8C%85%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">#</a></h2>\n<p>涉及两个模块的开发：</p>\n<ul>\n<li>tcc-transaction-dubbo-redpacket-api，方便调用方使用接口定义</li>\n<li>tcc-transaction-dubbo-redpacket，提供红包相关操作实现、服务暴露等功能</li>\n</ul>\n<h3 id=\"tcc-transaction-dubbo-redpacket-api%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-redpacket-api开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-redpacket-api%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>方便调用方使用资金服务的接口定义</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-2\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-2\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-api<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h4 id=\"%E5%A3%B0%E6%98%8Etcc%E6%8E%A5%E5%8F%A3-1\">声明tcc接口 <a class=\"header-anchor\" href=\"#%E5%A3%B0%E6%98%8Etcc%E6%8E%A5%E5%8F%A3-1\">#</a></h4>\n<p>使用<a href=\"/zh-cn/docs/tutorial/api.html#%40enabletcc\">@EnableTcc</a>传递上下文</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">RedPacketTradeOrderService</span> </span>{\n    <span class=\"hljs-meta\">@EnableTcc</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">record</span><span class=\"hljs-params\">(RedPacketTradeOrderDto tradeOrderDto)</span></span>;\n}\n</code></pre>\n<h3 id=\"tcc-transaction-dubbo-redpacket%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-redpacket开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-redpacket%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>提供红包相关操作实现、服务暴露等功能</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-3\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-3\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-dubbo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-spring<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h4 id=\"spring-xml%E9%85%8D%E7%BD%AE-1\">spring xml配置 <a class=\"header-anchor\" href=\"#spring-xml%E9%85%8D%E7%BD%AE-1\">#</a></h4>\n<p>appcontext-service-tcc.xml开发，这里提供了embedded模式的两种配置，您可以选择一种配置：</p>\n<ul>\n<li>embedded存储模式之MEMORY</li>\n<li>embedded存储模式之REDIS(如需演示dashboard，可选择此中存储类型)</li>\n</ul>\n<h5 id=\"embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory-1\">embedded存储模式之MEMORY <a class=\"header-anchor\" href=\"#embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory-1\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:REDPACKET\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--embedded存储模式(MEMORY)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"MEMORY\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h5 id=\"embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis-1\">embedded存储模式之REDIS <a class=\"header-anchor\" href=\"#embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis-1\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:REDPACKET\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--embedded存储模式(REDIS)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"REDIS\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"redis\"</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.RedisStoreProperties\"</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"host\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"127.0.0.1\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"port\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"6379\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"database\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"0\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"poolConfig\"</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"redis.clients.jedis.JedisPoolConfig\"</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxTotal\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxWaitMillis\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"300\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"minIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"10\"</span>/&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h4 id=\"tcc%E5%AE%9E%E7%8E%B0-1\">tcc实现 <a class=\"header-anchor\" href=\"#tcc%E5%AE%9E%E7%8E%B0-1\">#</a></h4>\n<p>在tcc实现上方法上添加<a href=\"/zh-cn/docs/tutorial/api.html#%40compensable\">@Compensable</a>注解，设置confirmMethod和cancelMethod方法，分别为tcc的confirm和cancel方法。<br>\n<strong>特别注意</strong>：confirm和cancel方法参数要与try保持一致。</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">RedPacketTradeOrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">RedPacketTradeOrderService</span> </span>{\n    <span class=\"hljs-meta\">@Compensable</span>(confirmMethod = <span class=\"hljs-string\">\"confirmRecord\"</span>, cancelMethod = <span class=\"hljs-string\">\"cancelRecord\"</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">record</span><span class=\"hljs-params\">(RedPacketTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"success\"</span>;\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">confirmRecord</span><span class=\"hljs-params\">(RedPacketTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">cancelRecord</span><span class=\"hljs-params\">(RedPacketTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n}\n\n</code></pre>\n<h2 id=\"%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">订单服务开发 <a class=\"header-anchor\" href=\"#%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">#</a></h2>\n<p>提供下单支付相关功能，只有一个模块tcc-transaction-dubbo-order</p>\n<h3 id=\"tcc-transaction-dubbo-order%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-order开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-order%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>提供下单支付相关功能</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-4\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-4\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-dubbo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-spring<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n\n</code></pre>\n<h4 id=\"spring-xml%E9%85%8D%E7%BD%AE-2\">spring xml配置 <a class=\"header-anchor\" href=\"#spring-xml%E9%85%8D%E7%BD%AE-2\">#</a></h4>\n<p>appcontext-service-tcc.xml开发，这里提供了embedded模式的两种配置，您可以选择一种配置：</p>\n<ul>\n<li>embedded存储模式之MEMORY</li>\n<li>embedded存储模式之REDIS(如需演示dashboard，可选择此中存储类型)</li>\n</ul>\n<h5 id=\"embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory-2\">embedded存储模式之MEMORY <a class=\"header-anchor\" href=\"#embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory-2\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:ORDER\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--embedded存储模式(MEMORY)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"MEMORY\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h5 id=\"embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis-2\">embedded存储模式之REDIS <a class=\"header-anchor\" href=\"#embedded%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis-2\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:ORDER\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--embedded存储模式(REDIS)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"REDIS\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"redis\"</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.RedisStoreProperties\"</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"host\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"127.0.0.1\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"port\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"6379\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"database\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"0\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"poolConfig\"</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"redis.clients.jedis.JedisPoolConfig\"</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxTotal\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxWaitMillis\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"300\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"minIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"10\"</span>/&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h4 id=\"tcc%E5%AE%9E%E7%8E%B0-2\">tcc实现 <a class=\"header-anchor\" href=\"#tcc%E5%AE%9E%E7%8E%B0-2\">#</a></h4>\n<p>在tcc实现上方法上添加<a href=\"/zh-cn/docs/tutorial/api.html#%40compensable\">@Compensable</a>注解，设置confirmMethod和cancelMethod方法，分别为tcc的confirm和cancel方法。<br>\n<strong>特别注意</strong>：confirm和cancel方法参数要与try保持一致。</p>\n<pre><code class=\"language-java\"><span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">PaymentServiceImpl</span> </span>{\n    <span class=\"hljs-meta\">@Compensable</span>(confirmMethod = <span class=\"hljs-string\">\"confirmMakePayment\"</span>, cancelMethod = <span class=\"hljs-string\">\"cancelMakePayment\"</span>, asyncConfirm = <span class=\"hljs-keyword\">false</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">makePayment</span><span class=\"hljs-params\">(@UniqueIdentity String orderNo)</span> </span>{\n        String result = capitalTradeOrderService.record(buildCapitalTradeOrderDto(order));\n        String result2 = redPacketTradeOrderService.record(buildRedPacketTradeOrderDto(order));\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">confirmMakePayment</span><span class=\"hljs-params\">(String orderNo)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">cancelMakePayment</span><span class=\"hljs-params\">(String orderNo)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n}\n\n</code></pre>\n<h2 id=\"%E5%8A%9F%E8%83%BD%E6%BC%94%E7%A4%BA\">功能演示 <a class=\"header-anchor\" href=\"#%E5%8A%9F%E8%83%BD%E6%BC%94%E7%A4%BA\">#</a></h2>\n<h3 id=\"%E6%9C%AC%E5%9C%B0%E5%90%AF%E5%8A%A8\">本地启动 <a class=\"header-anchor\" href=\"#%E6%9C%AC%E5%9C%B0%E5%90%AF%E5%8A%A8\">#</a></h3>\n<p>分别启动tcc-transaction-dubbo-capital、tcc-transaction-dubbo-redpacket、tcc-transaction-dubbo-order\n<img src=\"../../img/dubbo_sample_idea_start_view.jpg\" alt=\"服务启动\"></p>\n<h4 id=\"%E6%B5%8B%E8%AF%95%E9%A1%B5%E9%9D%A2%E6%BC%94%E7%A4%BA\">测试页面演示 <a class=\"header-anchor\" href=\"#%E6%B5%8B%E8%AF%95%E9%A1%B5%E9%9D%A2%E6%BC%94%E7%A4%BA\">#</a></h4>\n<p>测试页面入口：<a href=\"http://localhost:8081\">http://localhost:8081</a>\n<img src=\"../../img/page_tcc_sample_order.jpg\" alt=\"下单商品页\"><br>\n选择购买商品\n<img src=\"../../img/page_dubbo_sample_pay.jpg\" alt=\"支付\">\n点击支付按钮\n<img src=\"../../img/page_dubbo_sample_pay_result.jpg\" alt=\"支付结果页\"></p>\n<h4 id=\"%E6%97%A5%E5%BF%97%E6%BC%94%E7%A4%BA\">日志演示 <a class=\"header-anchor\" href=\"#%E6%97%A5%E5%BF%97%E6%BC%94%E7%A4%BA\">#</a></h4>\n<p>注意调用的先后顺序。<br>\ntry阶段</p>\n<pre><code class=\"language-text\">1、order try make payment called.time seq:2022-07-13 17:46:04\n2、capital try record called. time seq:2022-07-13 17:46:06\n3、red packet try record called. time seq:2022-07-13 17:46:07\n</code></pre>\n<p>confirm阶段</p>\n<pre><code class=\"language-text\">1、order confirm make payment called. time seq:2022-07-13 17:46:08\n2、capital confirm record called. time seq:2022-07-13 17:46:09\n3、red packet confirm record called. time seq:2022-07-13 17:46:10\n</code></pre>\n<h4 id=\"dashboard%E6%BC%94%E7%A4%BA\">dashboard演示 <a class=\"header-anchor\" href=\"#dashboard%E6%BC%94%E7%A4%BA\">#</a></h4>\n<p>访问地址：<a href=\"http://localhost:22332/tcc-transaction-dashboard\">http://localhost:22332/tcc-transaction-dashboard</a><br>\n默认用户: admin<br>\n默认密码：123456<br>\n详细操作参考<a href=\"/zh-cn/docs/ops/dashboard/dashboard-guild.html\">dashboard使用手册</a></p>\n<p><strong>首页</strong><br>\n登录成功后进入首页<br>\n<img src=\"../../img/sample_dashboard_local_welcome.jpg\" alt=\"首页\"></p>\n<p><strong>Domain管理</strong><br>\n资金、红包、订单这三个服务启动，会自动注册domain<br>\n<img src=\"../../img/sample_dashboard_local_domain_manage.jpg\" alt=\"Domain管理\"></p>\n<p><strong>事件管理</strong><br>\n出现异常事件，或者发生事件堆积，可以通过事件管理查看，并进行相关操作<br>\n<img src=\"../../img/sample_dashboard_local_transaction_manage_show.jpg\" alt=\"事件管理\"></p>\n<h2 id=\"%E7%BB%93%E6%9D%9F\">结束 <a class=\"header-anchor\" href=\"#%E7%BB%93%E6%9D%9F\">#</a></h2>\n<p><strong>注意事项</strong></p>\n<ul>\n<li>TCC事务的confirm和cancel方法的声明必须和try方法入参一致。</li>\n<li>如果是作为分支事务提供给上游服务调用时，接口方法必须添加注解@EnableTcc，否则会影响事务上下文传递</li>\n<li>客户端如果选择server模式，务必先把tcc-server服务启动起来</li>\n</ul>\n<p>恭喜你，顺序正确说明dubbo-sample项目运行成功。</p>\n",
  "link": "/zh-cn/docs/tutorial/quickstart/embedded-sample.html",
  "meta": {}
}