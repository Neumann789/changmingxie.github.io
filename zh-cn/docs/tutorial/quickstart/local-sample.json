{
  "filename": "local-sample.md",
  "__html": "<h1 id=\"local%E6%A8%A1%E5%BC%8F%E6%BC%94%E7%A4%BA\">local模式演示 <a class=\"header-anchor\" href=\"#local%E6%A8%A1%E5%BC%8F%E6%BC%94%E7%A4%BA\">#</a></h1>\n<p>local模式，即<a href=\"/zh-cn/docs/tutorial/storagemode/local.html\">local存储模式</a></p>\n<p>这里用dubbo-sample来说演示<strong>local模式</strong></p>\n<p>示例工程:<a href=\"https://github.com/changmingxie/tcc-transaction/tree/master-2.x/tcc-transaction-tutorial-sample/tcc-transaction-dubbo-sample\">tcc-transaction-dubbo-sample</a></p>\n<blockquote>\n<p>tcc-transaction-dubbo-capital(资金服务)<br>\ntcc-transaction-dubbo-redpacket(红包服务)<br>\ntcc-transaction-dubbo-order(订单服务)</p>\n</blockquote>\n<p>以下将一步一步教大家如何使用tcc-transaction的local模式</p>\n<h2 id=\"%E8%B5%84%E9%87%91%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">资金服务开发 <a class=\"header-anchor\" href=\"#%E8%B5%84%E9%87%91%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">#</a></h2>\n<p>涉及两个模块的开发：</p>\n<ul>\n<li>tcc-transaction-dubbo-capital-api，方便调用方使用接口定义</li>\n<li>tcc-transaction-dubbo-capital，提供资金相关操作实现、服务暴露等功能</li>\n</ul>\n<h3 id=\"tcc-transaction-dubbo-capital-api%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-capital-api开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-capital-api%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>方便调用方使用资金服务的接口定义</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-api<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h4 id=\"%E5%A3%B0%E6%98%8Etcc%E6%8E%A5%E5%8F%A3\">声明tcc接口 <a class=\"header-anchor\" href=\"#%E5%A3%B0%E6%98%8Etcc%E6%8E%A5%E5%8F%A3\">#</a></h4>\n<p>查看<a href=\"/zh-cn/docs/tutorial/api.html#%40enabletcc\">@EnableTcc</a></p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">CapitalTradeOrderService</span> </span>{\n    <span class=\"hljs-meta\">@EnableTcc</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">record</span><span class=\"hljs-params\">(CapitalTradeOrderDto tradeOrderDto)</span></span>;\n}\n</code></pre>\n<h3 id=\"tcc-transaction-dubbo-capital%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-capital开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-capital%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>提供资金相关操作实现、服务暴露等功能</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-1\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-1\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-dubbo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-spring<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h4 id=\"spring-xml%E9%85%8D%E7%BD%AE\">spring xml配置 <a class=\"header-anchor\" href=\"#spring-xml%E9%85%8D%E7%BD%AE\">#</a></h4>\n<p>appcontext-service-tcc.xml开发，这里提供了本地模式的两种配置，您可以选择一种配置：</p>\n<ul>\n<li>本地存储模式之MEMORY</li>\n<li>本地存储模式之REDIS</li>\n</ul>\n<h5 id=\"%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory\">本地存储模式之MEMORY <a class=\"header-anchor\" href=\"#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:CAPITAL\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--本地存储模式(MEMORY)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"MEMORY\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h5 id=\"%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis\">本地存储模式之REDIS <a class=\"header-anchor\" href=\"#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:CAPITAL\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--本地存储模式(REDIS)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"REDIS\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"redis\"</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.RedisStoreProperties\"</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"host\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"127.0.0.1\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"port\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"6379\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"database\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"0\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"poolConfig\"</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"redis.clients.jedis.JedisPoolConfig\"</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxTotal\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxWaitMillis\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"300\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"minIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"10\"</span>/&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h4 id=\"tcc%E5%AE%9E%E7%8E%B0\">tcc实现 <a class=\"header-anchor\" href=\"#tcc%E5%AE%9E%E7%8E%B0\">#</a></h4>\n<p>在tcc实现上方法上添加<a href=\"/zh-cn/docs/tutorial/api.html#%40compensable\">@Compensable</a>注解，设置confirmMethod和cancelMethod方法，分别为tcc的confirm和cancel方法。</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CapitalTradeOrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">CapitalTradeOrderService</span> </span>{\n    <span class=\"hljs-meta\">@Compensable</span>(confirmMethod = <span class=\"hljs-string\">\"confirmRecord\"</span>, cancelMethod = <span class=\"hljs-string\">\"cancelRecord\"</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">record</span><span class=\"hljs-params\">(CapitalTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do someting ...</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"success\"</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">confirmRecord</span><span class=\"hljs-params\">(CapitalTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">cancelRecord</span><span class=\"hljs-params\">(CapitalTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n}\n\n</code></pre>\n<h2 id=\"%E7%BA%A2%E5%8C%85%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">红包服务开发 <a class=\"header-anchor\" href=\"#%E7%BA%A2%E5%8C%85%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">#</a></h2>\n<p>涉及两个模块的开发：</p>\n<ul>\n<li>tcc-transaction-dubbo-redpacket-api，方便调用方使用接口定义</li>\n<li>tcc-transaction-dubbo-redpacket，提供红包相关操作实现、服务暴露等功能</li>\n</ul>\n<h3 id=\"tcc-transaction-dubbo-redpacket-api%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-redpacket-api开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-redpacket-api%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>方便调用方使用资金服务的接口定义</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-2\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-2\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-api<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h4 id=\"%E5%A3%B0%E6%98%8Etcc%E6%8E%A5%E5%8F%A3-1\">声明tcc接口 <a class=\"header-anchor\" href=\"#%E5%A3%B0%E6%98%8Etcc%E6%8E%A5%E5%8F%A3-1\">#</a></h4>\n<p>查看<a href=\"/zh-cn/docs/tutorial/api.html#%40enabletcc\">@EnableTcc</a></p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">RedPacketTradeOrderService</span> </span>{\n    <span class=\"hljs-meta\">@EnableTcc</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">record</span><span class=\"hljs-params\">(RedPacketTradeOrderDto tradeOrderDto)</span></span>;\n}\n</code></pre>\n<h3 id=\"tcc-transaction-dubbo-redpacket%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-redpacket开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-redpacket%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>提供红包相关操作实现、服务暴露等功能</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-3\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-3\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-dubbo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-spring<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h4 id=\"spring-xml%E9%85%8D%E7%BD%AE-1\">spring xml配置 <a class=\"header-anchor\" href=\"#spring-xml%E9%85%8D%E7%BD%AE-1\">#</a></h4>\n<p>appcontext-service-tcc.xml开发，这里提供了本地模式的两种配置，您可以选择一种配置：</p>\n<ul>\n<li>本地存储模式之MEMORY</li>\n<li>本地存储模式之REDIS</li>\n</ul>\n<h5 id=\"%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory-1\">本地存储模式之MEMORY <a class=\"header-anchor\" href=\"#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory-1\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:REDPACKET\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--本地存储模式(MEMORY)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"MEMORY\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h5 id=\"%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis-1\">本地存储模式之REDIS <a class=\"header-anchor\" href=\"#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis-1\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:REDPACKET\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--本地存储模式(REDIS)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"REDIS\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"redis\"</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.RedisStoreProperties\"</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"host\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"127.0.0.1\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"port\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"6379\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"database\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"0\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"poolConfig\"</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"redis.clients.jedis.JedisPoolConfig\"</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxTotal\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxWaitMillis\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"300\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"minIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"10\"</span>/&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h4 id=\"tcc%E5%AE%9E%E7%8E%B0-1\">tcc实现 <a class=\"header-anchor\" href=\"#tcc%E5%AE%9E%E7%8E%B0-1\">#</a></h4>\n<p>在tcc实现上方法上添加<a href=\"/zh-cn/docs/tutorial/api.html#%40compensable\">@Compensable</a>注解，设置confirmMethod和cancelMethod方法，分别为tcc的confirm和cancel方法。</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">RedPacketTradeOrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">RedPacketTradeOrderService</span> </span>{\n    <span class=\"hljs-meta\">@Compensable</span>(confirmMethod = <span class=\"hljs-string\">\"confirmRecord\"</span>, cancelMethod = <span class=\"hljs-string\">\"cancelRecord\"</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">record</span><span class=\"hljs-params\">(RedPacketTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"success\"</span>;\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">confirmRecord</span><span class=\"hljs-params\">(RedPacketTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">cancelRecord</span><span class=\"hljs-params\">(RedPacketTradeOrderDto tradeOrderDto)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n}\n\n</code></pre>\n<h2 id=\"%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">订单服务开发 <a class=\"header-anchor\" href=\"#%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91\">#</a></h2>\n<p>提供下单支付相关功能，只有一个模块tcc-transaction-dubbo-order</p>\n<h3 id=\"tcc-transaction-dubbo-order%E5%BC%80%E5%8F%91\">tcc-transaction-dubbo-order开发 <a class=\"header-anchor\" href=\"#tcc-transaction-dubbo-order%E5%BC%80%E5%8F%91\">#</a></h3>\n<p>提供下单支付相关功能</p>\n<h4 id=\"%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-4\">添加maven依赖 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0maven%E4%BE%9D%E8%B5%96-4\">#</a></h4>\n<p>请选用<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">最新版本</a></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!--tcc依赖--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-dubbo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mengyun<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tcc-transaction-spring<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${tcc-transaction.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n\n</code></pre>\n<h4 id=\"spring-xml%E9%85%8D%E7%BD%AE-2\">spring xml配置 <a class=\"header-anchor\" href=\"#spring-xml%E9%85%8D%E7%BD%AE-2\">#</a></h4>\n<p>appcontext-service-tcc.xml开发，这里提供了本地模式的两种配置，您可以选择一种配置：</p>\n<ul>\n<li>本地存储模式之MEMORY</li>\n<li>本地存储模式之REDIS</li>\n</ul>\n<h5 id=\"%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory-2\">本地存储模式之MEMORY <a class=\"header-anchor\" href=\"#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bmemory-2\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:ORDER\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--本地存储模式(MEMORY)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"MEMORY\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h5 id=\"%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis-2\">本地存储模式之REDIS <a class=\"header-anchor\" href=\"#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%A8%A1%E5%BC%8F%E4%B9%8Bredis-2\">#</a></h5>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">beans</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n       <span class=\"hljs-attr\">xmlns:tcc</span>=<span class=\"hljs-string\">\"http://www.tcctransaction.org/schema/tcc\"</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans\"</span>\n       <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.tcctransaction.org/schema/tcc http://www.tcctransaction.org/schema/tcc.xsd\"</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!--驱动TccClient--&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tcc:annotation-driven</span> <span class=\"hljs-attr\">client-config</span>=<span class=\"hljs-string\">\"clientConfig\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.ClientConfig\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"clientConfig\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.RecoveryProperties\"</span>&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--开启补偿任务--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"recoveryEnabled\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"true\"</span>/&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storeConfig\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.StoreProperties\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"domain\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"TCC:DUBBO:ORDER\"</span>/&gt;</span>\n                <span class=\"hljs-comment\">&lt;!--本地存储模式(REDIS)--&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"storageType\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"REDIS\"</span>/&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"redis\"</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"org.mengyun.tcctransaction.properties.store.RedisStoreProperties\"</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"host\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"127.0.0.1\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"port\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"6379\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"database\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"0\"</span>/&gt;</span>\n                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"poolConfig\"</span>&gt;</span>\n                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">bean</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"redis.clients.jedis.JedisPoolConfig\"</span>&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxTotal\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"100\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"maxWaitMillis\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"300\"</span>/&gt;</span>\n                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"minIdle\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"10\"</span>/&gt;</span>\n                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">property</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">bean</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">beans</span>&gt;</span>\n\n</code></pre>\n<h4 id=\"tcc%E5%AE%9E%E7%8E%B0-2\">tcc实现 <a class=\"header-anchor\" href=\"#tcc%E5%AE%9E%E7%8E%B0-2\">#</a></h4>\n<p>在tcc实现上方法上添加<a href=\"/zh-cn/docs/tutorial/api.html#%40compensable\">@Compensable</a>注解，设置confirmMethod和cancelMethod方法，分别为tcc的confirm和cancel方法。</p>\n<pre><code class=\"language-java\"><span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">PaymentServiceImpl</span> </span>{\n    <span class=\"hljs-meta\">@Compensable</span>(confirmMethod = <span class=\"hljs-string\">\"confirmMakePayment\"</span>, cancelMethod = <span class=\"hljs-string\">\"cancelMakePayment\"</span>, asyncConfirm = <span class=\"hljs-keyword\">false</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">makePayment</span><span class=\"hljs-params\">(@UniqueIdentity String orderNo)</span> </span>{\n        String result = capitalTradeOrderService.record(buildCapitalTradeOrderDto(order));\n        String result2 = redPacketTradeOrderService.record(buildRedPacketTradeOrderDto(order));\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">confirmMakePayment</span><span class=\"hljs-params\">(String orderNo)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">cancelMakePayment</span><span class=\"hljs-params\">(String orderNo)</span> </span>{\n        <span class=\"hljs-comment\">// do something ...</span>\n    }\n}\n\n</code></pre>\n<h2 id=\"dashboard%E9%83%A8%E7%BD%B2\">dashboard部署 <a class=\"header-anchor\" href=\"#dashboard%E9%83%A8%E7%BD%B2\">#</a></h2>\n<p>TODO 待完善</p>\n<h2 id=\"%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%B9%B6%E6%BC%94%E7%A4%BA\">服务启动并演示 <a class=\"header-anchor\" href=\"#%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%B9%B6%E6%BC%94%E7%A4%BA\">#</a></h2>\n<h3 id=\"%E6%9C%AC%E5%9C%B0idea%E5%90%AF%E5%8A%A8\">本地idea启动 <a class=\"header-anchor\" href=\"#%E6%9C%AC%E5%9C%B0idea%E5%90%AF%E5%8A%A8\">#</a></h3>\n<p>分别启动tcc-transaction-dubbo-capital、tcc-transaction-dubbo-redpacket、tcc-transaction-dubbo-order\n<img src=\"../../img/dubbo_sample_idea_start_view.jpg\" alt=\"服务启动\"></p>\n<h5 id=\"%E9%A1%B5%E9%9D%A2%E6%BC%94%E7%A4%BA\">页面演示 <a class=\"header-anchor\" href=\"#%E9%A1%B5%E9%9D%A2%E6%BC%94%E7%A4%BA\">#</a></h5>\n<p>测试页面入口：<a href=\"http://localhost:8081\">http://localhost:8081</a>\n<img src=\"../../img/page_tcc_sample_order.jpg\" alt=\"下单商品页\"><br>\n选择购买商品\n<img src=\"../../img/page_dubbo_sample_pay.jpg\" alt=\"支付\">\n点击支付按钮\n<img src=\"../../img/page_dubbo_sample_pay_result.jpg\" alt=\"支付结果页\"></p>\n<h5 id=\"%E6%97%A5%E5%BF%97%E6%98%BE%E7%A4%BA\">日志显示 <a class=\"header-anchor\" href=\"#%E6%97%A5%E5%BF%97%E6%98%BE%E7%A4%BA\">#</a></h5>\n<p>try阶段</p>\n<pre><code class=\"language-text\">1、order try make payment called.time seq:2022-07-13 17:46:04\n2、capital try record called. time seq:2022-07-13 17:46:06\n3、red packet try record called. time seq:2022-07-13 17:46:07\n</code></pre>\n<p>confirm阶段</p>\n<pre><code class=\"language-text\">1、order confirm make payment called. time seq:2022-07-13 17:46:08\n2、capital confirm record called. time seq:2022-07-13 17:46:09\n3、red packet confirm record called. time seq:2022-07-13 17:46:10\n</code></pre>\n<p>恭喜你，顺序正确说明dubbo-sample项目运行成功。</p>\n",
  "link": "/zh-cn/docs/tutorial/quickstart/local-sample.html",
  "meta": {}
}