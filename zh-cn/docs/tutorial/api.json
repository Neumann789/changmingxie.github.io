{
  "filename": "api.md",
  "__html": "<h1 id=\"api%E6%94%AF%E6%8C%81\">API支持 <a class=\"header-anchor\" href=\"#api%E6%94%AF%E6%8C%81\">#</a></h1>\n<h2 id=\"%E6%A0%B8%E5%BF%83%E7%B1%BB\">核心类 <a class=\"header-anchor\" href=\"#%E6%A0%B8%E5%BF%83%E7%B1%BB\">#</a></h2>\n<h3 id=\"compensabletransactioninterceptor\">CompensableTransactionInterceptor <a class=\"header-anchor\" href=\"#compensabletransactioninterceptor\">#</a></h3>\n<p>对注解@Compensable进行拦截，实现对主事务、分支事务的try-confirm-cancel流程。</p>\n<h3 id=\"resourcecoordinatorinterceptor\">ResourceCoordinatorInterceptor <a class=\"header-anchor\" href=\"#resourcecoordinatorinterceptor\">#</a></h3>\n<p>对注解@Compensable或者@EnableTcc进行拦截，实现事件及参与方存储。</p>\n<h3 id=\"transactioncontext\">TransactionContext <a class=\"header-anchor\" href=\"#transactioncontext\">#</a></h3>\n<p>事件上下文</p>\n<h2 id=\"%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3\">核心注解 <a class=\"header-anchor\" href=\"#%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3\">#</a></h2>\n<h3 id=\"%40compensable\">@Compensable <a class=\"header-anchor\" href=\"#%40compensable\">#</a></h3>\n<p>此注解放在try方法上，用于定义tcc的执行逻辑，即try-confirm-cancel三阶段的实现，<strong>特别注意</strong>：confirm和cancel方法参数要与try保持一致\n<strong>属性说明</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"><div style=\"width:50px\">参数名</div></th>\n<th style=\"text-align:left\"><div style=\"width:200px\">含义</div></th>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">可选值</th>\n<th style=\"text-align:left\">默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">propagation</td>\n<td style=\"text-align:left\">传播方式，预留字段，暂时没用到</td>\n<td style=\"text-align:left\">String</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">confirmMethod</td>\n<td style=\"text-align:left\">confirm方法名</td>\n<td style=\"text-align:left\">String</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">cancelMethod</td>\n<td style=\"text-align:left\">cancel方法名</td>\n<td style=\"text-align:left\">String</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">asyncConfirm</td>\n<td style=\"text-align:left\">异步confirm</td>\n<td style=\"text-align:left\">boolean</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">默认为false</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">asyncCancel</td>\n<td style=\"text-align:left\">异步cancel</td>\n<td style=\"text-align:left\">boolean</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">默认为false</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"%40enabletcc\">@EnableTcc <a class=\"header-anchor\" href=\"#%40enabletcc\">#</a></h3>\n<p>此注解用于声明tcc接口，用于远程调用时传递事件上下文(TransactionContext)</p>\n<h3 id=\"%40uniqueidentity\">@UniqueIdentity <a class=\"header-anchor\" href=\"#%40uniqueidentity\">#</a></h3>\n<p>此注解作用于方法参数上，参数一般为订单号，可保证同一个订单并发请求是只产生一个事件，第二个请求时会报异常。<br>\n使用可参考如下：</p>\n<pre><code class=\"language-java\">    <span class=\"hljs-meta\">@Compensable</span>(confirmMethod = <span class=\"hljs-string\">\"confirmMakePayment\"</span>, cancelMethod = <span class=\"hljs-string\">\"cancelMakePayment\"</span>, asyncConfirm = <span class=\"hljs-keyword\">false</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">makePayment</span><span class=\"hljs-params\">(@UniqueIdentity String orderNo)</span> </span>{\n        System.out.println(<span class=\"hljs-string\">\"order try make payment called.time seq:\"</span> + DateFormatUtils.format(Calendar.getInstance(), <span class=\"hljs-string\">\"yyyy-MM-dd HH:mm:ss\"</span>));\n\n        Order order = orderRepository.findByMerchantOrderNo(orderNo);\n\n        String result = capitalTradeOrderService.record(buildCapitalTradeOrderDto(order));\n        String result2 = redPacketTradeOrderService.record(buildRedPacketTradeOrderDto(order));\n    }\n</code></pre>\n",
  "link": "/zh-cn/docs/tutorial/api.html",
  "meta": {}
}